## 16. 効果音を鳴らそう

### 概要

前章まででゲームの全体的な流れを作ることができました。本章からは、このゲームのディティールをより良くしていきましょう。まずは、いまだ無音のこのゲームの様々なアクションに効果音をつけていきます。本章では、Altseedで音を再生する方法について解説します。

### どこに音を付ける？

まずは、このゲームのどこに効果音を付けたいかを考えます。このゲームにはさまざまなアクションが存在します。主なアクションは次のとおりです。

* プレイヤーが弾を撃つ
* 敵が弾を撃つ
* 敵が破壊される

今回はこれらのアクションに効果音を付けましょう。

### 音声ファイルの再生方法

Altseedで音声を鳴らすのに必要なことは、音声ファイルをロードし、再生したいタイミングで決められたメソッドを呼び出すことだけです。

#### ロード

音声のロードは、ゲームやオブジェクトのはじめに１回だけ呼び出される場所に記述し、変数に持っておくのがよいでしょう。音声ファイルをロードするには次のメソッドを呼び出します。ファイル形式はwavかoggです。

```C#
SoundSource sound = Engine.Sound.CreateSoundSource("Resources/Sound.wav", true);
```

このメソッドの第１引数は、ロードしたい音声ファイルの場所です。第２引数は、音声ファイルをその場で解凍するかどうかを指定します。基本的に効果音の場合は`true`を指定するのですが、これについて詳しくは後述の「もっと詳しく」の節で解説します。

#### 再生

そして、実際の音声の再生は、音声を鳴らしたい瞬間のコードで行いましょう。音声を再生するには次のメソッドを呼び出します。

```C#
// soundはロードした音声を保持する変数
Engine.Sound.Play(sound);
```

### アクションに効果音を付ける

それでは、ゲームのアクションに効果音をつけていきましょう。最初は、プレイヤーが弾を撃つときの音を付けます。まずは音声ファイルをロードして変数に持つのですが、その変数をどのクラスの中に宣言するのがよいのかを考える必要がありますね。ロードした音声を持たせる変数を実際に使うのは、プレイヤーが弾を撃つ瞬間ですから、プレイヤークラスの中に宣言されているとアクセスしやすいでしょう。なので、今回はプレイヤークラスの中に宣言することにしましょう。

以上のことを踏まえて、以下のようにプレイヤークラスを書き換えます。

```diff
Playerクラス。ロード処理をコンストラクタに書くか、OnStartに書くかを後で考える。
```

これで、プレイヤーが弾を撃つ瞬間に効果音が鳴るようになります。実行結果はこの講座では解説しきれないものなので、実行して試してみてください。

同じ要領で、敵が弾を撃つ瞬間にも効果音を鳴らしてみましょう。まず敵クラスのコンストラクタで音声ファイルをロードします。次のようにコードを書き換えましょう。

```diff
Enemyクラス
```

そして、敵が弾を撃つ瞬間のコードを書き換えて効果音が鳴るようにします。

```diff
Enemyクラス
```

最後に、敵が破壊される瞬間に効果音を鳴らしてみましょう。

### もっと詳しく

#### 音声ファイルの解凍

音声ファイルを再生するには、音声ファイルを解凍する必要があります。Altseedでは音声ファイルを読み込む際、ロード時に一気に解凍してしまう方法と、再生しながらいま必要な分だけ解凍する方法があります。それぞれ、以下の様な特性を持っています。

* ロード時に一気に解凍してメモリに読み込む方法
    * CPUへの負荷が小さい：再生中に解凍処理をしなくて済むため
    * メモリへの負荷が大きい：ファイル全部をメモリに読み込むため。ファイルサイズが大きいほど負荷が大きい。
    * ロードに時間がかかる：ファイル全部をメモリに読み込むため。ファイルサイズが大きいほど時間がかかる。
* 再生しながらいま必要な分だけ解凍してメモリに読み込む方法
	* CPUへの負荷が大きい：再生しながら解凍処理をするため
	* メモリへの負荷が小さい：ファイルの必要な部分だけをメモリに読み込むため。ファイルサイズが大きくても大丈夫。
	* ロードに比較的時間がかからない：ファイルの必要な部分だけをメモリに読み込むため。

以上のような特性を持つため、ファイルサイズの小さい効果音のようなファイルはロード時に解凍し、BGMのようなファイルサイズの大きなファイルは再生しながら解凍することが多いです。なので、今回は効果音ですから`CreateSoundSource`の第２引数には`true`を指定することになります。

#### ファイルのキャッシュ機能

敵が弾を撃つときの効果音を付けるところで敵が生成されるたびに音声ファイルがロードされるように実装しましたが、音声ファイルのロードはそれなりに時間のかかる処理です。同じファイルを敵の１つ１つでそれぞれロードするよりは、一回だけロードしてそれをすべての敵インスタンスで使いまわしたほうがいいのではないでしょうか？実は、このような同じファイルのロードを一回だけにする機能（キャッシュ機能）がAltseedには備わっています。同じファイルのロードであれば、ある程度ロードした内容を使いまわしてくれるので、ロードが必要以上に重くなる心配はいりません。

### まとめ

本章では、ゲームのさまざまなアクションに効果音を付けることができました。効果音を付けると、ゲーム内のさまざまなアクションが生き生きと表現されます。みなさんのゲームでも、アクションにはどんどん効果音をつけていってください。

効果音が鳴らせるようになると、今度はBGMを鳴らしたくなってきませんか？次の章では、ゲームにBGMをつけていきましょう。