## 09. 当たり判定を実装してみよう

### 概要

前回までの内容で、複雑な動きをする敵がいくつか増えました。
しかし、依然として「自機が敵の弾に当たっても」「敵が自機の弾に当たっても」何も起こらず、これではどうもゲームらしくないですね。

そこで今回は、シューティングゲームにおいて最も重要な「当たり判定」の書き方を解説していきたいと思います。

### 「当たり判定」とは

「当たり判定」とは読んで字の如く、オブジェクト同士が当たっているかどうか判定するものです。当たり判定の実装方法には色々な手法が考えられますが、今回は簡単のために「円同士の当たり判定をピクセル単位で取る」という方法を扱います。

例えば下のような２つの円のオブジェクトを考え、２つの円の中心座標を考えてみましょう。２つの円の半径をa, bとおき、２つの円のx座標の差をd、y座標の差をeとおくと、中学校で習うような「三平方の定理」よりd^2+e^2<(a+b)^2ならば２つの円は「ぶつかっている」ということになりますね。

<図>



### 下準備をしよう

さて、今まで書いたコードについては、当たり判定を導入する前にいくつかの下準備をする必要があります。

### 実装してみよう

では、実際に当たり判定のコードを実装してみましょう。実装は、以下のようになります。

### コラム：さらに踏み込んだ当たり判定を作るには

ここまでの方法で、「１つのフレーム内で、キャラクターと弾が当たっているかどうか」という当たり判定を取得することが出来ました。今回は自機の動作も敵の動作もゆっくりしているので、大方見た目通りの当たり判定が取れるようになっているかと思います。

ここで、次のような場合を考えてみましょう。

<図>

困ったことになりました。この２フレームの「間」では２つの物体は「当たっている」はずなのですが、両方のフレームでは計算上「当たっていない」ことになっているため、見かけ上「すり抜け」が起きてしまいます。
このような「すり抜け」を回避するためには、２つの物体の現在地と移動ベクトルを利用し、下図のように２つの物体の進路に交点があるかどうかを計算する必要があります。

<図>

具体的な計算方法については本章では長くなるため省略しますが、踏み込んだ当たり判定の方法としてこのような方法もあるということは覚えておくとよいでしょう。