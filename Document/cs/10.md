## 10. 敵を倒した時の処理

### 概要

前回までの内容で、自機と敵・敵と自機の弾がそれぞれ衝突した時の当たり判定を実装しました。
しかし、実際に当たり判定を取ったところで、例えば「敵に当たった弾が消える」等の目に見える効果がないと、折角当たり判定を実装した意味がありません。
そこで今回は、当たり判定によって「衝突している」と判定されたオブジェクトを消してみる、爆発のエフェクトを付けてみる、などの処理を書いてみましょう。

### ぶつかった部分にエフェクトを出してみる

![エフェクト](img/10_BreakObject.png)

```cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace STG
{
	// オブジェクトが破壊された時に表示されるエフェクト
	public class BreakObjectEffect : asd.TextureObject2D
	{
		// エフェクトの1コマあたりのテクスチャの1辺あたりの長さ
		const int TextureSize = 128;

		// 横方向のコマ数
		const int TextureXCount = 4;

		// 縦方向のコマ数
		const int TextureYCount = 4;

		// 毎フレーム1増加し続けるカウンタ変数
		protected int count;

		// コンストラクタ(初期位置を引数として受け取る。)
		public BreakObjectEffect(asd.Vector2DF pos)
			: base()
		{
			// インスタンスの位置を設定する。
			Position = pos;

			// 画像の中心位置を設定する。
			CenterPosition = new asd.Vector2DF(TextureSize / 2, TextureSize / 2);

			//　画像を読み込み、敵のインスタンスに画像を設定する。
			Texture = asd.Engine.Graphics.CreateTexture2D("Resources/BreakObject.png");

			// 設定された画像で実際に表示する範囲を設定する。
			Src = new asd.RectF(0, 0, TextureSize, TextureSize);

			// アルファブレンドの方法を加算に変更する。
			AlphaBlend = asd.AlphaBlendMode.Add;
		}

		protected override void OnUpdate()
		{
			// 表示するアニメーションの位置を計算する。
			int x = count % TextureXCount;
			int y = count / TextureXCount;

			// 設定された画像で実際に表示する範囲を設定する。
			Src = new asd.RectF(x * TextureSize, y * TextureSize, TextureSize, TextureSize);

			// アニメーションが再生し終わったら削除する。
			if (count == TextureXCount * TextureYCount)
			{
				Vanish();
			}

			++count;
		}
	}
}

```

```Player``` クラス

```cs
	// Vanishが実行された時に実行される。
	protected override void OnVanish()
	{
		// このインスタンスと同じ位置にエフェクトインスタンスを生成して、エンジンに追加する。
		asd.Engine.AddObject2D(new BreakObjectEffect(Position));
	}
```

```Enemy``` クラス

```cs
	// Vanishが実行された時に実行される。
	protected override void OnVanish()
	{
		// このインスタンスと同じ位置にエフェクトインスタンスを生成して、エンジンに追加する。
		asd.Engine.AddObject2D(new BreakObjectEffect(Position));
	}
```

すべての変更を適用した結果をダウンロードできるようにしておきます。参考にしてください。

[プロジェクト(Windows)](Projects/STG10.zip?raw=true)

[プロジェクト(Mac)]

### まとめ

本章では、衝突した破壊された時にエフェクトが発生するようにしました。
ゲームとしては最低限の要素は揃いましたが、タイトル画面がないので次回はシーン遷移を実装します。

