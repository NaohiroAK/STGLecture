## 17. BGMを流そう

### 概要

本章では、このゲームの背景にBGMを流す方法について解説します。

### BGMの再生方法

ACEでBGMを鳴らす方法は、効果音の場合とほぼ同じです。音声ファイルをロードし、再生したいタイミングで決められたメソッドを呼び出すことで再生します。また、BGMをループさせるための機能も、ACEには備わっています。

#### ロード

ACEでBGMをロードする方法は、効果音の時とほぼ同じです。ただし１つだけ違う点があります。それは、`CreateSoundSource`メソッドに渡す引数です。BGMの場合は基本的に次のようにメソッドを呼び出します。

```C#
SoundSource bgm = Engine.Sound.CreateSoundSource("Resources/Bgm.ogg", false);
```

第２引数に渡す値が、効果音の時は`true`だったのが、BGMでは`false`になります。この引数は音声ファイルを一気に解凍するかどうかを指定しています。`false`を指定すると、一気には読み込まず再生しながら必要な分だけ解凍していきます。詳しくは、[16章](./16.md)の「もっと詳しく」の節で解説しています。

#### 再生

そして、実際にBGMを再生するには、再生を開始したいタイミングに次の命令を書きます。これは効果音の時と同じ命令です。

```C#
// bgmはロードした音声を保持している変数
Engine.Sound.Play(bgm);
```

#### ループ

BGMは、再生が終了した時に何度も最初から再生し直したい場合があります。そのような場合は、次のようなコードを記述します。

```C#
// bgmはロードした音声を保持している変数
bgm.IsLoopingMode = true;		// ループ機能を有効にする
bgm.LoopStartingPoint = 10.0f;	// ループの開始地点を指定する
bgm.LoopEndPoint = 101.7f		// ループの終了地点を指定する
```

`SoundSource.IsLoopingMode`を`true`に設定すると、ループ機能が有効になります。有効にすると、音声の再生が`LoopEndPoint`に達したとき、`LoopStartingPoint`からふたたび再生が始まります。実のところ、効果音でもループをすることはできます。

### ゲームにBGMを付ける

今回は、STG部分のステージ１にだけBGMを付けることにしましょう。効果音の時はロードは１回、再生は何度も鳴らしましたが、今回はロードも再生も１回で済みますので、すべての処理を初期化時に行ってしまいましょう。STGシーンクラスのコードに、次のようにBGMをロードして再生する処理を追加します。

```diff
おそらくステージ遷移あたりに登場するであろうSTGシーンクラス。ロード・再生処理をコンストラクタに書くかOnStartに書くかは考える。
```

ループ処理をしているので、再生が終わっても最初からまた再生が始まるはずです。実行結果は、当講座では音をだすことができないので皆さんの耳で確かめてみてください。

### まとめ

本章では、ゲームにBGMを付けることができました。効果音とBGMによって、ゲームがよりゲームらしくなったかと思います。次の章では、敵の弾を消すことの出来るボムを実装しましょう。